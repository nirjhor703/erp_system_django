{% extends 'base.html' %}
{% load static %}

{% block content %}

<h3>Store Details</h3>

<!-- Add Button + Search -->
<div class="d-flex justify-content-between mb-3">
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal">+ Add Store Details</button>
    <input type="text" id="searchInput" class="form-control w-25" placeholder="Search...">
</div>

<!-- Table -->
<table class="table table-bordered">
    <thead>
        <tr>
            <th>SL</th>
            <th>Store Name</th>
            <th>Division</th>
            <th>Location</th>
            <th>Address</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        {% for s in stores %}
        <tr id="row{{ s.id }}">
            <td>{{ forloop.counter }}</td>
            <td>{{ s.store_name }}</td>
            <td>{{ s.division }}</td>
            <td>
                {% for loc in locations %}
                    {% if loc.id == s.location_id %}
                        {{ loc.upazila }}
                    {% endif %}
                {% endfor %}
            </td>

            <td>{{ s.address }}</td>
            <td>
                <button class="btn btn-sm btn-warning editBtn" data-id="{{ s.id }}">Edit</button>
                <button class="btn btn-sm btn-danger deleteBtn" data-id="{{ s.id }}">Delete</button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Add Modal -->
<div class="modal fade" id="addModal" tabindex="-1">
  <div class="modal-dialog">
    <form id="addForm" class="modal-content">
        {% csrf_token %}
        <div class="modal-header">
            <h5 class="modal-title">Add Store Details</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
            <label>Store Name *</label>
            <input type="text" name="store_name" class="form-control mb-2" placeholder="Store Name" required>

            <label>Division *</label>
            <select name="division" id="add_division" class="form-control mb-2" required>
                <option value="">Select Division</option>
                {% for loc in locations %}
                    <option value="{{ loc.division }}">{{ loc.division }}</option>
                {% endfor %}
            </select>

            <label>Location *</label>
            <select name="location_id" id="add_location" class="form-control mb-2" required>
                <option value="">Select Location</option>
                {% for loc in locations %}
                    <option value="{{ loc.id }}">{{ loc.upazila }}</option>
                {% endfor %}
            </select>

            <label>Address</label>
            <input type="text" name="address" class="form-control mb-2" placeholder="Address">
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" type="submit">Submit</button>
        </div>
    </form>
  </div>
</div>

<!-- Edit Modal (Same structure as Add) -->
<div class="modal fade" id="editModal" tabindex="-1">
  <div class="modal-dialog">
    <form id="editForm" class="modal-content">
        {% csrf_token %}
        <input type="hidden" name="id" id="edit_id">
        <div class="modal-header">
            <h5 class="modal-title">Edit Store Details</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
            <label>Store Name *</label>
            <input type="text" name="store_name" id="edit_name" class="form-control mb-2" placeholder="Store Name" required>

            <label>Division *</label>
            <select name="division" id="edit_division" class="form-control mb-2" required>
                <option value="">Select Division</option>
                {% for loc in locations %}
                    <option value="{{ loc.division }}">{{ loc.division }}</option>
                {% endfor %}
            </select>

            <label>Location *</label>
            <select name="location_id" id="edit_location" class="form-control mb-2" required>
                <option value="">Select Location</option>
                {% for loc in locations %}
                    <option value="{{ loc.id }}">{{ loc.upazila }}</option>
                {% endfor %}
            </select>

            <label>Address</label>
            <input type="text" name="address" id="edit_address" class="form-control mb-2" placeholder="Address">
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" type="submit">Submit</button>
        </div>
    </form>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
<script src="{% static 'js/store/store_info.js' %}"></script>
{% endblock %}
