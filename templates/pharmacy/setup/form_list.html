{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="card">

        <div>
            <label>Show </label>
            <select id="rowsSelect" class="form-select d-inline-block w-auto">
                {% for n in rows_options %}
                    <option value="{{ n }}" {% if rows_per_page|stringformat:"s" == n|stringformat:"s" %}selected{% endif %}>{{ n }}</option>
                {% endfor %}
            </select>
        </div>
    </div>
    <div class="d-flex justify-content-between mb-3">
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal">+ Add Form Details</button>
        <input type="text" id="searchInput" class="form-control w-25 global-search" placeholder="Search...">
    </div>
    <div class="card-body">
        <h5 class="text-center mb-3">Item Form Details</h5>

        <table class="table table-bordered table-hover text-center filter-table">
            <thead>
                <tr>
                    <th>SL</th>
                    <th>Item Form Name</th>
                    <th>Company Name</th>
                    <th width="120">Action</th>
                </tr>
                <tr class="filter-row">
                    <th></th>
                    <th><input class="form-control column-filter" data-col="1" placeholder="Search Form"></th>
                    <th><input class="form-control column-filter" data-col="2" placeholder="Search Company"></th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for f in forms %}
                <tr id="row{{ f.id }}">
                    <td>{{ forloop.counter0|add:forms.start_index }}</td>
                    <td>{{ f.form_name }}</td>
                    <td>{% if f.company %}{{ f.company.company_name }}{% else %}-{% endif %}</td>
                    <td>
                        <button class="btn btn-sm btn-primary editBtn" data-id="{{ f.id }}">Edit</button>
                        <button class="btn btn-sm btn-danger deleteBtn" data-id="{{ f.id }}">Delete</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Pagination -->
        <nav>
            <ul class="pagination justify-content-center">
                {% if forms.has_previous %}
                    <li class="page-item"><a class="page-link" href="?page={{ forms.previous_page_number }}&rows={{ rows_per_page }}">Previous</a></li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">Previous</span></li>
                {% endif %}

                {% for num in forms.paginator.page_range %}
                    {% if forms.number == num %}
                        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                    {% else %}
                        <li class="page-item"><a class="page-link" href="?page={{ num }}&rows={{ rows_per_page }}">{{ num }}</a></li>
                    {% endif %}
                {% endfor %}

                {% if forms.has_next %}
                    <li class="page-item"><a class="page-link" href="?page={{ forms.next_page_number }}&rows={{ rows_per_page }}">Next</a></li>
                {% else %}
                    <li class="page-item disabled"><span class="page-link">Next</span></li>
                {% endif %}
            </ul>
        </nav>

    </div>
</div>

<!-- ADD MODAL -->
<div class="modal fade" id="addModal">
    <div class="modal-dialog">
        <form id="addForm" class="modal-content">{% csrf_token %}
            <div class="modal-header"><h5>Add Item Form</h5></div>
            <div class="modal-body">
                <label>Item Form Name *</label>
                <input name="form_name" class="form-control mb-2" required>

                <label>Company *</label>
                <select name="company" class="form-control mb-2" required>
                    <option value="">Select Company</option>
                    {% for c in companies %}
                        <option value="{{ c.company_id }}">{{ c.company_name }}</option>
                    {% endfor %}
                </select>

                <input type="hidden" name="type" value="{{ request.session.active_module }}">
            </div>
            <div class="modal-footer"><button class="btn btn-success">Save</button></div>
        </form>
    </div>
</div>

<!-- EDIT MODAL -->
<div class="modal fade" id="editModal">
    <div class="modal-dialog">
        <form id="editForm" class="modal-content">{% csrf_token %}
            <input type="hidden" name="id" id="edit_id">
            <div class="modal-header"><h5>Edit Item Form</h5></div>
            <div class="modal-body">
                <label>Item Form Name *</label>
                <input id="edit_name" name="form_name" class="form-control mb-2" required>

                <label>Company *</label>
                <select id="edit_company" name="company" class="form-control mb-2" required>
                    <option value="">Select Company</option>
                    {% for c in companies %}
                        <option value="{{ c.company_id }}">{{ c.company_name }}</option>
                    {% endfor %}
                </select>

                <input type="hidden" id="edit_type" name="type" value="{{ request.session.active_module }}">
            </div>
            <div class="modal-footer"><button class="btn btn-primary">Update</button></div>
        </form>
    </div>
</div>

{% endblock %}
{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'js/pharmacy/setup/form.js' %}"></script>
<script src="{% static 'js/common-table-filter.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
{% endblock %}
