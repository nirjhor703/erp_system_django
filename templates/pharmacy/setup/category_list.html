{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="card">

<!-- Top bar with Add & Rows per page -->
    <!-- Header -->
<div class="d-flex justify-content-between mb-3">
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addModal">+ Add Category Details</button>
    <input type="text" id="searchInput" class="form-control w-25 global-search" placeholder="Search...">
</div>

<div class="card-body">
<h5 class="text-center mb-3">Item Category Details</h5>

<table class="table table-bordered table-hover text-center filter-table">
<thead>
<tr>
    <th>SL</th>
    <th>Item Category Name</th>
    <th>Company Name</th>
    <th>Group Name</th>
    <th width="120">Action</th>
</tr>
<tr class="filter-row">
    <th></th>
    <th><input class="form-control column-filter" data-col="1" placeholder="Search Category"></th>
    <th><input class="form-control column-filter" data-col="2" placeholder="Search Company"></th>
    <th></th>
</tr>
</thead>
<div class="d-flex justify-content-between align-items-center mb-2">


    <div>
        <label>Show 
            <select id="rowsPerPage" class="form-select d-inline-block w-auto">
                <option value="15" {% if rows_per_page == 15 %}selected{% endif %}>15</option>
                <option value="30" {% if rows_per_page == 30 %}selected{% endif %}>30</option>
                <option value="50" {% if rows_per_page == 50 %}selected{% endif %}>50</option>
                <option value="100" {% if rows_per_page == 100 %}selected{% endif %}>100</option>
                <option value="500" {% if rows_per_page == 500 %}selected{% endif %}>500</option>
            </select> 
</div>

<tbody>
{% for c in categories %}
<tr id="row{{ c.id }}">
    <td>{{ forloop.counter0|add:categories.start_index }}</td>
    <td>{{ c.category_name }}</td>
    <td>{% if c.company %}{{ c.company.company_name }}{% else %}-{% endif %}</td>
    <td>{% if c.group %}{{ c.group.tran_groupe_name }}{% else %}-{% endif %}</td>

    <td>
        <button class="btn btn-sm btn-primary editBtn" data-id="{{ c.id }}">Edit</button>
        <button class="btn btn-sm btn-danger deleteBtn" data-id="{{ c.id }}">Delete</button>
    </td>
</tr>
{% empty %}
<tr><td colspan="4">No categories found.</td></tr>
{% endfor %}
</tbody>
</table>

<!-- Pagination -->
<nav>
    <ul class="pagination justify-content-center">
        {% if categories.has_previous %}
        <li class="page-item"><a class="page-link" href="?page={{ categories.previous_page_number }}&rows={{ rows_per_page }}">Previous</a></li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">Previous</span></li>
        {% endif %}

        {% for num in categories.paginator.page_range %}
            {% if num >= categories.number|add:'-1' and num <= categories.number|add:'1' %}
                {% if categories.number == num %}
                <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                {% else %}
                <li class="page-item"><a class="page-link" href="?page={{ num }}&rows={{ rows_per_page }}">{{ num }}</a></li>
                {% endif %}
            {% endif %}
        {% endfor %}

        {% if categories.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ categories.next_page_number }}&rows={{ rows_per_page }}">Next</a></li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">Next</span></li>
        {% endif %}

        <!-- Last page button -->
        {% if categories.number != categories.paginator.num_pages %}
        <li class="page-item"><a class="page-link" href="?page={{ categories.paginator.num_pages }}&rows={{ rows_per_page }}">Last</a></li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">Last</span></li>
        {% endif %}
    </ul>
</nav>
</div>
</div>

<!-- ADD MODAL -->
<div class="modal fade" id="addModal" data-bs-backdrop="static" data-bs-keyboard="false">
<div class="modal-dialog">
<form id="addForm" class="modal-content">{% csrf_token %}
    <input type="hidden" name="type" value="{{ selected_type.id }}">
<div class="modal-header">
    <h5 class="modal-title">Add Item Category</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
    <label>Item Category Name *</label>
    <input name="category_name" id="category_name" class="form-control mb-2" required>

    <label>Company *</label>
    <select name="company" class="form-control mb-2" required>
        <option value="">Select Company</option>
        {% for c in companies %}
        <option value="{{c.company_id}}">{{c.company_name}}</option>
        {% endfor %}
    </select>

    <!-- Optional Type -->
    <label>Type</label>
    <input type="text" class="form-control" value="{{ selected_type.type_name }}" readonly>
    <input type="hidden" name="type" id="add_type" value="{{ module_id }}">




    <label>Group</label>
    <select name="group" id="add_group" class="form-control mb-3" required>
    <option value="">Select Group</option>
    </select>

</div>
<div class="modal-footer"><button class="btn btn-success">Submit</button></div>
</form>
</div>
</div>

<!-- EDIT MODAL -->
<div class="modal fade" id="editModal" data-bs-backdrop="static" data-bs-keyboard="false">
<div class="modal-dialog">
<form id="editForm" class="modal-content">{% csrf_token %}
<input type="hidden" name="id" id="edit_id">
<div class="modal-header">
    <h5 class="modal-title">Edit Item Category</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
    <label>Item Category Name *</label>
    <input id="edit_name" name="category_name" class="form-control mb-2" required>

    <label>Company *</label>
    <select id="edit_company" name="company" class="form-control mb-2" required>
        <option value="">Select Company</option>
        {% for c in companies %}
        <option value="{{c.company_id}}">{{c.company_name}}</option>
        {% endfor %}
    </select>

    <!-- Optional Type -->
    <label>Type</label>
    <select id="edit_type" name="type" class="form-control mb-2">
        <option value="">Select Type</option>
        {% for t in types %}
        <option value="{{t.id}}">{{ t.type_name }}</option>
        {% endfor %}
    </select>

    <label>Group</label>
    <select id="edit_group" name="group" class="form-control mb-2">
        <option value="">Select Group</option>
        {% for g in groups %}
        <option value="{{g.id}}">{{ g.tran_groupe_name }}</option>
        {% endfor %}
    </select>

</div>
<div class="modal-footer"><button class="btn btn-primary">Update</button></div>
</form>
</div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
<script src="{% static 'js/pharmacy/setup/category.js' %}"></script>
<script src="{% static 'js/common-table-filter.js' %}"></script>
{% endblock %}
